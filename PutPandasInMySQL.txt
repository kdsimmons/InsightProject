import pandas as pd
import pymysql as mdb

# create pandas dataframe called pandadf

def convert_to_sql(charities):
    # get username and password for MySQL
    mysqlauth = pd.DataFrame.from_csv('mysql_user.csv')
    user = mysqlauth.username[0]
    password = mysqlauth.password[0]
    
    con = mdb.connect('localhost', user, password, 'charity_data')
    with con:
        cur = con.cursor()
        
        # set up table
        cur.execute("DROP TABLE IF EXISTS charities_sql")
        cur.execute("\
            CREATE TABLE charities_sql(\
                id INT PRIMARY KEY AUTO_INCREMENT,\
                name VARCHAR(255),\
                address VARCHAR(255),\
                city VARCHAR(255),\
                link VARCHAR(255),\
                bbb_link VARCHAR(255),\
                facebook_link VARCHAR(255),\
                twitter_link VARCHAR(255),\
                bbb_accred CHAR(3),\
                char_nav_score FLOAT(8,4),\
                facebook_likes INT,\
                twitter_followers INT\
           )"\
        ) 

        # put data in table
        for idx in range(len(charities)):
            cur.execute("INSERT INTO charities_sql(name) VALUES(%s)", str(charities.name[idx]))
            cur.execute("INSERT INTO charities_sql(address) VALUES(%s)", str(charities.address[idx]))
            cur.execute("INSERT INTO charities_sql(city) VALUES(%s)", str(charities.city[idx]))
            cur.execute("INSERT INTO charities_sql(link) VALUES(%s)", str(charities.link[idx]))
            cur.execute("INSERT INTO charities_sql(bbb_link) VALUES(%s)", str(charities.bbb_link[idx]))
            cur.execute("INSERT INTO charities_sql(facebook_link) VALUES(%s)", str(charities.facebook_link[idx])) 
            cur.execute("INSERT INTO charities_sql(twitter_link) VALUES(%s)", str(charities.twitter_link[idx]))
            cur.execute("INSERT INTO charities_sql(bbb_accred) VALUES(%s)", str(charities.bbb_accred[idx]))
            cur.execute("INSERT INTO charities_sql(char_nav_score) VALUES(%s)", str(charities.char_nav_score[idx])) 
            cur.execute("INSERT INTO charities_sql(facebook_likes) VALUES(%s)", str(charities.facebook_likes[idx]))
            cur.execute("INSERT INTO charities_sql(twitter_followers) VALUES(%s)", str(charities.twitter_followers[idx]))
    
        # print or return table for debugging
        cur.execute("SELECT * FROM charities_sql")
        rows = cur.fetchall()
        #for row in rows:
         #   print row
            
    return rows

sqlrows = convert_to_sql(pandadf)
